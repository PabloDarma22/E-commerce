{% extends "base.html" %}
{% load static %}

{% block title %}{{ product.name }} - STORE{% endblock %}

{% block content %}
<main>
  <div class="container">

    <!-- BREADCRUMB -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a href="{% url 'home' %}">Início</a>
      <span class="breadcrumb-sep">/</span>

      {% if product.category %}
        <a href="{% url 'home' %}?q={{ product.category.name|urlencode }}">{{ product.category.name }}</a>
        <span class="breadcrumb-sep">/</span>
      {% endif %}

      <span>{{ product.name }}</span>
    </nav>

    <!-- PRODUCT DETAIL -->
    <div class="product-detail">
      <div class="product-gallery">
        {% if product.image %}
          <img src="{{ product.image.url }}" alt="{{ product.name }}">
        {% else %}
          <img src="{% static 'img/placeholder.jpg' %}" alt="{{ product.name }}">
        {% endif %}
      </div>

      <div class="product-info">
        {% if product.category %}
          <span class="product-category">{{ product.category.name }}</span>
        {% endif %}

        <h1>{{ product.name }}</h1>

        <div class="product-price">R$ {{ product.price }}</div>

        {% if product.stock > 0 %}
          <span class="product-stock in-stock">
            Em estoque ({{ product.stock }} unidade{{ product.stock|pluralize:"s" }})
          </span>
        {% else %}
          <span class="product-stock out-of-stock">Fora de estoque</span>
        {% endif %}

        {% if product.description %}
          <p class="product-description">
            {{ product.description }}
          </p>
        {% endif %}

        {% if product.stock > 0 %}
          <form action="{% url 'cart_add' product_id=product.id %}" method="post">
            {% csrf_token %}

            <div class="quantity-selector">
              <label for="quantity">Quantidade:</label>
              <input
                type="number"
                id="quantity"
                name="quantity"
                value="1"
                min="1"
                max="{{ product.stock }}"
                class="form-control"
              >
            </div>

            <button type="submit" class="btn btn-accent btn-lg">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                   viewBox="0 0 24 24" fill="none" stroke="currentColor"
                   stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="8" cy="21" r="1"/>
                <circle cx="19" cy="21" r="1"/>
                <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
              </svg>
              Adicionar ao Carrinho
            </button>
          </form>
        {% else %}
          <p class="text-muted">Este produto está indisponível no momento.</p>
        {% endif %}
      </div>
    </div>

  </div>
</main>
{% endblock %}
